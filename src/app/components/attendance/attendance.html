<div class="dashboard-container">
    <app-sidebar></app-sidebar>

    <main class="main-content">
        <header class="top-bar">
            <div class="header-left">
                <h1>Attendance Portal</h1>
                <p class="subtitle">Track records, generate reports and monitor presence</p>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs-container card">
            <button class="tab-btn" [class.active]="activeTab === 'my'" (click)="setTab('my')">
                <span class="icon">üë§</span> My Attendance
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'today'" (click)="setTab('today')">
                <span class="icon">üè¢</span> Today's Overview
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'daily'" (click)="setTab('daily')">
                <span class="icon">üìÖ</span> Daily Report
            </button>
            <button class="tab-btn" [class.active]="activeTab === 'range'" (click)="setTab('range')">
                <span class="icon">üìä</span> All History
            </button>
        </div>

        @if (isLoading) {
        <div class="loading-state card">
            <div class="spinner"></div>
            <p>Fetching attendance records...</p>
        </div>
        } @else {
        <!-- Tab Content Area -->
        <div class="tab-content">

            <!-- My Attendance Tab -->
            @if (activeTab === 'my') {
            <div class="tab-pane">
                <div class="filter-bar card">
                    <div class="filter-group">
                        <label>From Date</label>
                        <input type="date" [(ngModel)]="myStart" (ngModelChange)="loadMyAttendance()">
                    </div>
                    <div class="filter-group">
                        <label>To Date</label>
                        <input type="date" [(ngModel)]="myEnd" (ngModelChange)="loadMyAttendance()">
                    </div>
                    <div class="summary-meta">
                        Showing results for <strong>{{ currentUser?.emp_name }}</strong>
                    </div>
                </div>

                <div class="table-container card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Punch In</th>
                                <th>Punch Out</th>
                                <th>Status</th>
                                <th>Total Hours</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (record of myAttendance; track record.id) {
                            <tr>
                                <td>{{ record.emp_login_date | date:'dd/MM/yyyy' }}</td>
                                <td>{{ record.emp_login_time || '--:--' }}</td>
                                <td>{{ record.emp_logoff_time || '--:--' }}</td>
                                <td>
                                    <span class="status-badge" [class.present]="record.emp_login_status === 1"
                                        [class.absent]="record.emp_login_status === 0">
                                        {{ record.emp_login_status === 1 ? 'Present' : 'Absent' }}
                                    </span>
                                </td>
                                <td>{{ record.working_hours || '0.00' }} hrs</td>
                            </tr>
                            } @empty {
                            <tr>
                                <td colspan="5" class="empty-row text-center">No attendance records found for this
                                    range.</td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            }

            <!-- Today's Overview Tab -->
            @if (activeTab === 'today') {
            <div class="tab-pane">
                <div class="stats-overview">
                    <div class="stat-mini-card present">
                        <span class="label">Total Present</span>
                        <span class="count">{{ todayStats?.present_count || 0 }}</span>
                    </div>
                    <div class="stat-mini-card absent">
                        <span class="label">Total Absent</span>
                        <span class="count">{{ todayStats?.absent_count || 0 }}</span>
                    </div>
                    <div class="stat-mini-card total">
                        <span class="label">Total Employees</span>
                        <span class="count">{{ todayStats?.total_employees || 0 }}</span>
                    </div>
                </div>

                <div class="table-container card mt-32">
                    <h3>Today's Presence List</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Designation</th>
                                <th>In Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (emp of todayList; track emp.emp_profile_id) {
                            <tr>
                                <td class="emp-cell">
                                    <div class="mini-avatar">{{ emp.emp_first_name.charAt(0) }}</div>
                                    {{ emp.emp_first_name }} {{ emp.emp_last_name }}
                                </td>
                                <td>{{ emp.emp_designation }}</td>
                                <td>{{ emp.emp_login_time || '--:--' }}</td>
                                <td>
                                    <span class="status-badge" [class.present]="emp.emp_login_status === 1"
                                        [class.absent]="emp.emp_login_status === 0"
                                        [class.awaiting]="emp.emp_login_status === null || emp.emp_login_status === undefined">
                                        {{ emp.emp_login_status === 1 ? 'Present' : (emp.emp_login_status === 0 ?
                                        'Absent' : 'Awaiting') }}
                                    </span>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            }

            <!-- Daily Report Tab -->
            @if (activeTab === 'daily') {
            <div class="tab-pane">
                <div class="filter-bar card">
                    <div class="filter-group">
                        <label>Select Date</label>
                        <input type="date" [(ngModel)]="selectedDate" (ngModelChange)="loadDailyReport()">
                    </div>
                </div>

                <div class="table-container card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Employee Name</th>
                                <th>Punch In</th>
                                <th>Punch Out</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (record of dailyAttendance; track record.id) {
                            <tr>
                                <td>#{{ record.emp_profile_id }}</td>
                                <td>{{ record.emp_first_name }} {{ record.emp_last_name }}</td>
                                <td>{{ record.emp_login_time || '--:--' }}</td>
                                <td>{{ record.emp_logoff_time || '--:--' }}</td>
                                <td>
                                    <span class="status-badge" [class.present]="record.emp_login_status === 1"
                                        [class.absent]="record.emp_login_status === 0"
                                        [class.awaiting]="record.emp_login_status === null || record.emp_login_status === undefined">
                                        {{ record.emp_login_status === 1 ? 'Present' : (record.emp_login_status === 0 ?
                                        'Absent' : 'Awaiting') }}
                                    </span>
                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            }

            <!-- All History Range Tab -->
            @if (activeTab === 'range') {
            <div class="tab-pane">
                <div class="filter-bar card">
                    <div class="filter-group">
                        <label>From Date</label>
                        <input type="date" [(ngModel)]="rangeStart" (ngModelChange)="loadRangeReport()">
                    </div>
                    <div class="filter-group">
                        <label>To Date</label>
                        <input type="date" [(ngModel)]="rangeEnd" (ngModelChange)="loadRangeReport()">
                    </div>
                </div>

                <div class="table-container card">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>ID</th>
                                <th>Employee Name</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (record of pagedRangeAttendance; track (record.type === 'header' ? record.date :
                            record.id)) {
                            @if (record.type === 'header') {
                            <tr class="date-separator">
                                <td colspan="4" class="date-divider">
                                    üìÖ {{ record.date | date:'dd/MM/yyyy' }}
                                </td>
                            </tr>
                            } @else {
                            <tr>
                                <td><span class="status-badge awaiting">ENTRY</span></td>
                                <td>#{{ record.emp_profile_id }}</td>
                                <td>{{ record.emp_first_name }} {{ record.emp_last_name }}</td>
                                <td>
                                    <span class="status-badge" [class.present]="record.emp_login_status === 1"
                                        [class.absent]="record.emp_login_status === 0"
                                        [class.awaiting]="record.emp_login_status === null || record.emp_login_status === undefined">
                                        {{ record.emp_login_status === 1 ? 'Present' : (record.emp_login_status === 0 ?
                                        'Absent' : 'Awaiting') }}
                                    </span>
                                </td>
                            </tr>
                            }
                            }
                        </tbody>
                    </table>

                    @if (allDates.length > itemsPerPage) {
                    <div class="pagination-container">
                        <div class="page-info">
                            Page <strong>{{ currentPage }}</strong> of <strong>{{ totalPages }}</strong>
                            <span class="ml-12 text-muted">({{ allDates.length }} days total)</span>
                        </div>
                        <div class="pagination-actions">
                            <button class="page-btn" (click)="prevPage()" [disabled]="!hasPrev">
                                <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                        viewBox="0 0 24 24">
                                        <g class="arrow-left-circle-outline">
                                            <g fill="#2288fc" fill-rule="evenodd" class="Vector" clip-rule="evenodd"
                                                stroke-width="0.5" stroke="#2288fc">
                                                <path
                                                    d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10m-10 8a8 8 0 1 0 0-16a8 8 0 0 0 0 16" />
                                                <path d="M7 12a1 1 0 0 1 1-1h8a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1" />
                                                <path
                                                    d="M7.293 12.707a1 1 0 0 1 0-1.414l3-3a1 1 0 1 1 1.414 1.414L9.414 12l2.293 2.293a1 1 0 0 1-1.414 1.414z" />
                                            </g>
                                        </g>
                                    </svg></span> Previous
                            </button>
                            <button class="page-btn" (click)="nextPage()" [disabled]="!hasMore">
                                Next <span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                        viewBox="0 0 24 24">
                                        <g class="arrow-right-circle-outline">
                                            <g fill="#2288fc" fill-rule="evenodd" class="Vector" clip-rule="evenodd"
                                                stroke-width="0.5" stroke="#2288fc">
                                                <path
                                                    d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10m-10 8a8 8 0 1 0 0-16a8 8 0 0 0 0 16" />
                                                <path d="M17 12a1 1 0 0 1-1 1H8a1 1 0 1 1 0-2h8a1 1 0 0 1 1 1" />
                                                <path
                                                    d="M16.707 11.293a1 1 0 0 1 0 1.414l-3 3a1 1 0 0 1-1.414-1.414L14.586 12l-2.293-2.293a1 1 0 0 1 1.414-1.414z" />
                                            </g>
                                        </g>
                                    </svg></span>
                            </button>
                        </div>
                    </div>
                    }
                </div>
            </div>
            }

        </div>
        }
    </main>
</div>